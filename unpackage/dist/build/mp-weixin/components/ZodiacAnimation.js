"use strict";const o=require("../utils/zodiac.js"),i=require("../common/vendor.js"),e={props:{birthMonth:{type:[Number,String],default:1},birthDay:{type:[Number,String],default:1},animationType:{type:String,default:"video"},autoHide:{type:Boolean,default:!0},duration:{type:Number,default:6e3},showDebugInfo:{type:Boolean,default:!1}},data:()=>({zodiacSign:null,videoSrc:"",isHidden:!1,backgroundColor:"#000000",loadingStatus:"初始化",currentType:"video",videoError:!1,errorInfo:"",tryCount:0,videoTimeout:null}),created(){if(this.zodiacSign=o.getZodiacSign(this.birthMonth,this.birthDay),console.log("星座信息:",this.zodiacSign),this.zodiacSign){const i=o.getZodiacElement(this.zodiacSign.engName);this.backgroundColor=i.color}this.currentType=this.animationType,"video"===this.currentType&&this.setVideoSource(),this.autoHide&&setTimeout((()=>{this.hideAnimation()}),this.duration)},methods:{setVideoSource(){const o=this.zodiacSign.engName;this.tryCount+=1;let i="";i=1===this.tryCount?`../static/zodiac/${o}.mp4`:2===this.tryCount?`../../static/zodiac/${o}.mp4`:`static/zodiac/${o}.mp4`,this.videoSrc=i,this.videoError=!1,this.loadingStatus=`加载中(${this.tryCount}/3): ${i}`,console.log(`尝试加载视频: ${i}`),clearTimeout(this.videoTimeout),this.videoTimeout=setTimeout((()=>{this.loadingStatus.includes("加载中")&&(console.warn("视频加载超时"),this.onVideoError({error:"timeout",errMsg:"加载超时"}))}),5e3)},onVideoEnded(){console.log("视频播放完成"),this.loadingStatus="播放完成",this.$emit("animationComplete"),this.autoHide&&this.hideAnimation()},onVideoError(o){console.error("视频播放错误:",o);const i=o.detail||o;this.errorInfo=JSON.stringify(i),this.loadingStatus="播放出错",this.videoError=!0;let e="";i.errMsg&&i.errMsg.includes("MEDIA_ERR_SRC_NOT_SUPPORTED")?(e="视频格式不支持",console.error("视频格式不支持，请参考格式要求："),console.error("1. 格式：MP4（H.264编码，AAC音频）"),console.error("2. 分辨率：建议不超过720p"),console.error("3. 帧率：30fps"),console.error("4. 比特率：不超过1.5Mbps"),console.error("5. 大小：不超过10MB")):e="视频播放异常",this.$emit("videoError",{...i,videoPath:this.videoSrc,errorMessage:e}),this.tryCount<3?(console.log(`尝试其他路径(${this.tryCount}/3)`),this.setVideoSource()):(console.warn("视频加载多次失败，切换到SVG"),this.currentType="svg")},onVideoWaiting(){console.log("视频缓冲中..."),this.loadingStatus="缓冲中"},onVideoTimeUpdate(o){"播放中"!==this.loadingStatus&&(console.log("视频开始播放"),this.loadingStatus="播放中")},hideAnimation(){this.isHidden=!0,this.$emit("animationComplete")}}};if(!Array){i.resolveComponent("svg-animation")()}const t=i._export_sfc(e,[["render",function(o,e,t,n,r,d){var s,a,c;return i.e({a:"video"===t.animationType},"video"===t.animationType?i.e({b:!r.videoError&&r.videoSrc},!r.videoError&&r.videoSrc?{c:r.backgroundColor,d:i.o(((...o)=>d.onVideoEnded&&d.onVideoEnded(...o))),e:i.o(((...o)=>d.onVideoError&&d.onVideoError(...o))),f:i.o(((...o)=>d.onVideoWaiting&&d.onVideoWaiting(...o))),g:i.o(((...o)=>d.onVideoTimeUpdate&&d.onVideoTimeUpdate(...o)))}:{h:i.p({zodiac:(null==(s=r.zodiacSign)?void 0:s.engName)||"default"}),i:i.t(r.zodiacSign?r.zodiacSign.name:""),j:r.backgroundColor}):{k:i.p({zodiac:(null==(a=r.zodiacSign)?void 0:a.engName)||"default"}),l:i.t(r.zodiacSign?r.zodiacSign.name:""),m:r.backgroundColor},{n:t.showDebugInfo},t.showDebugInfo?i.e({o:i.t(r.videoSrc),p:i.t(r.loadingStatus),q:i.t(null==(c=r.zodiacSign)?void 0:c.name),r:r.errorInfo},r.errorInfo?{s:i.t(r.errorInfo)}:{}):{},{t:r.isHidden?"none":"flex"})}]]);wx.createComponent(t);
